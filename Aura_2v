<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.U.R.A. Direct Link</title>
    <style>
        :root { --cyan: #00f3ff; --panel: #111; --text: #e0e0e0; }
        body { background: #050505; color: var(--text); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .header { text-align: center; margin-bottom: 30px; }
        h1 { color: var(--cyan); text-shadow: 0 0 15px var(--cyan); letter-spacing: 4px; }

        .conn-box { background: var(--panel); border: 1px solid #333; padding: 20px; border-radius: 12px; width: 320px; text-align: center; margin-bottom: 20px; }
        
        .btn-connect { background: transparent; border: 2px solid var(--cyan); color: var(--cyan); padding: 12px 30px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-connect:hover { background: var(--cyan); color: #000; box-shadow: 0 0 20px var(--cyan); }

        .dashboard { display: none; width: 100%; max-width: 800px; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--panel); padding: 20px; border-radius: 12px; border-top: 3px solid var(--cyan); }

        input[type=range] { width: 100%; margin: 15px 0; accent-color: var(--cyan); }
        .emotion-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .e-btn { background: #222; border: 1px solid #444; color: white; padding: 10px; cursor: pointer; border-radius: 5px; }
        .e-btn:hover { border-color: var(--cyan); color: var(--cyan); }

        #terminal { background: #000; color: #0f0; padding: 10px; height: 100px; overflow-y: scroll; font-size: 0.8rem; border: 1px solid #222; margin-top: 20px; width: 100%; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>A.U.R.A. LINK</h1>
        <p>DIRECT BLE INTERFACE v2.0</p>
    </div>

    <div class="conn-box" id="login-screen">
        <button class="btn-connect" onclick="connectBLE()">PAIR WITH ROBOT</button>
        <p id="status" style="font-size: 0.8rem; margin-top: 15px; color: #666;">Waiting for connection...</p>
    </div>

    <div class="dashboard" id="main-ui">
        <div class="card">
            <h3>ü¶æ ACTUATORS</h3>
            <label>HEAD: <span id="hV">90</span>¬∞</label>
            <input type="range" min="0" max="180" value="90" oninput="sendMove('S1', this.value, 'hV')">
            
            <label>LEFT ARM: <span id="lV">0</span>¬∞</label>
            <input type="range" min="0" max="180" value="0" oninput="sendMove('S2', this.value, 'lV')">
            
            <label>RIGHT ARM: <span id="rV">0</span>¬∞</label>
            <input type="range" min="0" max="180" value="0" oninput="sendMove('S3', this.value, 'rV')">
        </div>

        <div class="card">
            <h3>üé≠ EMOTIONS</h3>
            <div class="emotion-btns">
                <button class="e-btn" onclick="sendData('EXP:HAPPY')">HAPPY üòä</button>
                <button class="e-btn" onclick="sendData('EXP:ANGRY')">ANGRY üò†</button>
                <button class="e-btn" onclick="sendData('EXP:SAD')">SAD üò¢</button>
                <button class="e-btn" onclick="sendData('EXP:SURPRISED')">SURPRISED üò≤</button>
            </div>
            <br>
            <h3>üó®Ô∏è TEXT TO OLED</h3>
            <input type="text" id="msgIn" placeholder="Type message..." style="width:70%; background:#000; color:white; border:1px solid #444; padding:5px;">
            <button onclick="sendMsg()" class="e-btn">SEND</button>
        </div>
    </div>

    <div id="terminal">System Initialized... Waiting for Link.</div>

    <script>
        let device, characteristic;
        const SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e"; // Nordic UART Service
        const TX_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";      // TX Characteristic

        async function connectBLE() {
            try {
                log("Searching for A.U.R.A...");
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'AURA' }],
                    optionalServices: [SERVICE_UUID]
                });

                log("Connecting to GATT Server...");
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                characteristic = await service.getCharacteristic(TX_UUID);

                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-ui').style.display = 'grid';
                log("Link Established: A.U.R.A. Online.");
            } catch (error) {
                log("Error: " + error);
            }
        }

        function sendMove(prefix, val, labelId) {
            document.getElementById(labelId).innerText = val;
            sendData(`${prefix}:${val}\n`);
        }

        function sendMsg() {
            const val = document.getElementById('msgIn').value;
            sendData(`MSG:${val}\n`);
        }

        async function sendData(data) {
            if (!characteristic) return;
            const encoder = new TextEncoder();
            await characteristic.writeValue(encoder.encode(data));
            log("TX >> " + data.trim());
        }

        function log(msg) {
            const t = document.getElementById('terminal');
            t.innerHTML += `<br>> ${msg}`;
            t.scrollTop = t.scrollHeight;
        }
    </script>
</body>
</html>
